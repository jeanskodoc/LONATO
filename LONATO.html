<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>LONATO ¬∑ Acc√®s comptes ¬∑ Codes uniques</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --vert: #006400;
            --jaune: #FFD700;
            --rouge: #CE1126;
            --blanc: #ffffff;
            --gris: #f5f5f5;
            --gris-fonce: #333;
            --bleu-loto: #1E3A8A;
            --turbo: #F59E0B;
            --tce: #8B5CF6;
            --jackpot: #DC2626;
            --banker: #059669;
            --perm: #7C3AED;
            --prediction: #EC4899;
            --copie: #00A36C;
            --nap: #4361EE;
            --info: #4895EF;
            --ombre: 0 4px 15px rgba(0,0,0,0.2);
            
            --arc-rouge: #EF4444;
            --arc-orange: #F97316;
            --arc-jaune: #EAB308;
            --arc-vert: #22C55E;
            --arc-bleu: #3B82F6;
            --arc-indigo: #6366F1;
            --arc-violet: #A855F7;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            transition: all 0.3s;
        }

        body.authenticated {
            background: linear-gradient(145deg, #0a3a2a, #3a2a1a, #7a1e1e);
            padding: 10px;
        }

        body:not(.authenticated) {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }

        /* ========== PAGE DE CONNEXION ========== */
        .login-container {
            max-width: 450px;
            width: 100%;
            background: var(--blanc);
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: var(--ombre);
            border: 3px solid var(--jaune);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .login-header h1 {
            color: var(--vert);
            font-size: clamp(1.5rem, 5vw, 2rem);
            margin-bottom: 8px;
        }

        .login-header h1 span {
            color: var(--rouge);
        }

        .login-header p {
            color: var(--gris-fonce);
            font-size: 0.9rem;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--jaune);
            padding-bottom: 8px;
        }

        .tab {
            flex: 1;
            padding: 10px 5px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .tab.active {
            background: var(--vert);
            color: var(--jaune);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--gris-fonce);
            font-size: 0.9rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--jaune);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .code-input {
            font-size: 1.3rem !important;
            text-align: center;
            letter-spacing: 4px;
            font-weight: bold;
        }

        .btn-login, .btn-register {
            width: 100%;
            padding: 12px;
            background: var(--vert);
            color: var(--jaune);
            border: 2px solid var(--jaune);
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .btn-register {
            background: var(--bleu-loto);
        }

        .btn-login:hover, .btn-register:hover {
            background: var(--rouge);
            transform: translateY(-3px);
            box-shadow: var(--ombre);
        }

        .message-area {
            margin-top: 15px;
        }

        .warning-message {
            background: #FFE5E5;
            border: 2px solid var(--rouge);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            color: var(--rouge);
            font-weight: bold;
        }

        .success-message {
            background: #E5FFE5;
            border: 2px solid var(--vert);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            color: var(--vert);
            font-weight: bold;
        }

        .info-text {
            text-align: center;
            margin-top: 15px;
            font-size: 0.8rem;
            color: #666;
            padding: 12px;
            background: #f0f0f0;
            border-radius: 10px;
        }

        /* ========== APPLICATION PRINCIPALE ========== */
        .app-container {
            max-width: 1800px;
            margin: 0 auto;
            display: none;
        }

        body.authenticated .app-container {
            display: block;
        }

        body.authenticated .login-container {
            display: none;
        }

        .header {
            background: var(--blanc);
            border-radius: 20px 20px 0 0;
            padding: 70px 15px 20px 15px;
            border: 3px solid var(--jaune);
            text-align: center;
            box-shadow: var(--ombre);
            position: relative;
        }

        .user-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--vert);
            color: var(--jaune);
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: bold;
            border: 2px solid var(--jaune);
            font-size: 0.8rem;
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .timer-display {
            position: absolute;
            top: 10px;
            left: 220px;
            background: var(--turbo);
            color: white;
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: bold;
            border: 2px solid var(--jaune);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .timer-display.warning {
            background: var(--rouge);
            animation: clignote 1s infinite;
        }

        @keyframes clignote {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .logout-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--rouge);
            color: white;
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            border: 2px solid var(--jaune);
            transition: all 0.3s;
            font-size: 0.8rem;
        }

        .logout-btn:hover {
            background: var(--gris-fonce);
        }

        h1 {
            color: var(--vert);
            font-size: clamp(1.2rem, 4vw, 2.4rem);
            margin-bottom: 5px;
            line-height: 1.3;
        }

        .subtitle {
            color: var(--rouge);
            font-size: clamp(0.7rem, 2.5vw, 1.1rem);
            font-weight: 500;
        }

        .time-banner {
            background: linear-gradient(135deg, var(--vert), var(--rouge));
            color: var(--jaune);
            padding: 12px 15px;
            border: 3px solid var(--jaune);
            border-top: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        @media (min-width: 640px) {
            .time-banner {
                flex-direction: row;
                justify-content: space-between;
            }
        }

        .current-time, .next-draw-info {
            background: rgba(255,255,255,0.15);
            padding: 6px 15px;
            border-radius: 50px;
            backdrop-filter: blur(5px);
            font-size: 0.9rem;
            width: 100%;
            text-align: center;
        }

        @media (min-width: 640px) {
            .current-time, .next-draw-info {
                width: auto;
            }
        }

        .next-draw {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            align-items: center;
        }

        @media (min-width: 640px) {
            .next-draw {
                flex-direction: row;
                width: auto;
            }
        }

        .countdown {
            background: var(--jaune);
            color: var(--vert);
            padding: 6px 15px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.9rem;
            width: 100%;
            text-align: center;
        }

        .info-banner {
            background: linear-gradient(135deg, var(--info), var(--bleu-loto));
            color: white;
            padding: 12px;
            border-radius: 12px;
            margin: 15px 0;
            font-size: 0.8rem;
            line-height: 1.5;
            text-align: center;
        }

        .days-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            justify-content: center;
        }

        .day-tab {
            padding: 8px 12px;
            background: var(--gris);
            border: 2px solid var(--jaune);
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.8rem;
            flex: 1 0 auto;
            min-width: 70px;
            text-align: center;
        }

        .day-tab.active {
            background: var(--vert);
            color: var(--jaune);
        }

        .games-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        @media (min-width: 480px) {
            .games-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .game-card {
            background: var(--gris);
            border: 2px solid var(--jaune);
            border-radius: 15px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-card.selected {
            background: var(--vert);
            color: var(--jaune);
        }

        .game-name {
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        @media (min-width: 992px) {
            .main-content {
                flex-direction: row;
            }
            .main-content > :first-child { flex: 2; }
            .main-content > :last-child { flex: 1; }
        }

        .panel {
            background: var(--blanc);
            border-radius: 15px;
            padding: 15px;
            border: 3px solid var(--jaune);
            margin-bottom: 15px;
        }

        .panel h2 {
            color: var(--vert);
            font-size: 1.2rem;
            border-bottom: 3px solid var(--jaune);
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        .bet-types-panel {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 15px 0;
        }

        .bet-type-card {
            background: var(--gris);
            border: 2px solid var(--jaune);
            border-radius: 10px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
        }

        .bet-type-card.selected {
            background: var(--vert);
            color: var(--jaune);
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            max-height: 250px;
            overflow-y: auto;
            padding: 10px;
            background: var(--gris);
            border-radius: 12px;
            border: 2px solid var(--jaune);
            margin: 15px 0;
        }

        @media (min-width: 768px) {
            .numbers-grid {
                grid-template-columns: repeat(15, 1fr);
            }
        }

        .number-btn {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--blanc);
            border: 2px solid var(--vert);
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.7rem;
        }

        .number-btn.selected {
            background: var(--vert);
            color: var(--jaune);
        }

        .number-btn.banker {
            background: var(--banker);
            color: white;
        }

        .selected-numbers {
            background: #fff3cd;
            border: 2px solid var(--jaune);
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
        }

        .selected-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            min-height: 40px;
            margin-top: 10px;
        }

        .number-tag {
            background: var(--vert);
            color: var(--jaune);
            padding: 4px 10px;
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }

        .number-tag.banker {
            background: var(--banker);
            color: white;
        }

        .number-tag button {
            background: none;
            border: none;
            color: var(--jaune);
            cursor: pointer;
            font-size: 1rem;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }

        @media (min-width: 480px) {
            .button-group {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }

        button {
            padding: 10px 15px;
            font-size: 0.8rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-transform: uppercase;
            flex: 1 1 auto;
            min-width: 120px;
            box-shadow: var(--ombre);
        }

        .btn-generate { background: var(--bleu-loto); color: white; }
        .btn-predict { background: var(--prediction); color: white; }
        .btn-primary { background: var(--vert); color: var(--jaune); }
        .btn-copy { background: var(--copie); color: white; padding: 4px 10px; font-size: 0.7rem; border-radius: 20px; cursor: pointer; }
        .btn-copy.copied { background: var(--vert); }

        .stake-info {
            background: var(--info);
            color: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            display: flex;
            flex-direction: column;
            gap: 5px;
            align-items: center;
            font-weight: bold;
        }

        @media (min-width: 480px) {
            .stake-info {
                flex-direction: row;
                justify-content: space-between;
            }
        }

        .ball {
            display: inline-flex;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            border: 3px solid white;
            margin: 0 2px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .ball:hover {
            transform: scale(1.2) translateY(-3px);
            z-index: 20;
        }

        .ball[data-color="1"] { background: radial-gradient(circle at 30% 30%, #FF9999, #EF4444); }
        .ball[data-color="2"] { background: radial-gradient(circle at 30% 30%, #FFBB99, #F97316); }
        .ball[data-color="3"] { background: radial-gradient(circle at 30% 30%, #FFFF99, #EAB308); color: black; }
        .ball[data-color="4"] { background: radial-gradient(circle at 30% 30%, #99FF99, #22C55E); color: black; }
        .ball[data-color="5"] { background: radial-gradient(circle at 30% 30%, #9999FF, #3B82F6); }
        .ball[data-color="6"] { background: radial-gradient(circle at 30% 30%, #AA99FF, #6366F1); }
        .ball[data-color="7"] { background: radial-gradient(circle at 30% 30%, #FF99FF, #A855F7); }

        .results-container {
            background: var(--gris);
            border-radius: 15px;
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid var(--jaune);
        }

        .result-item {
            background: var(--blanc);
            padding: 15px;
            margin: 8px 0;
            border-radius: 12px;
            border-left: 6px solid;
        }

        .result-item.nap { border-left-color: var(--nap); }
        .result-item.permutation { border-left-color: var(--perm); }
        .result-item.banker { border-left-color: var(--banker); }

        .result-header {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .type-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.65rem;
            background: var(--gris-fonce);
            color: white;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 6px 12px;
            background: var(--jaune);
            border-radius: 20px;
            cursor: pointer;
        }

        .page-info {
            padding: 6px 12px;
            background: white;
            border: 2px solid var(--jaune);
            border-radius: 20px;
        }

        .progress-bar {
            height: 20px;
            background: var(--gris);
            border-radius: 10px;
            border: 2px solid var(--jaune);
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--arc-rouge), var(--arc-jaune), var(--arc-vert));
            width: 0%;
            transition: width 0.4s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
        }

        .footer {
            background: var(--blanc);
            border-radius: 0 0 20px 20px;
            padding: 12px;
            border: 3px solid var(--jaune);
            border-top: none;
            text-align: center;
            margin-top: 15px;
            font-size: 0.7rem;
        }

        .toast-message {
            position: fixed;
            bottom: 15px;
            right: 15px;
            left: 15px;
            background: var(--vert);
            color: var(--jaune);
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: var(--ombre);
            z-index: 1000;
            animation: slideIn 0.3s;
            text-align: center;
        }

        @media (min-width: 768px) {
            .toast-message {
                left: auto;
                min-width: 300px;
            }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ========== HISTORIQUE DES ACTIVIT√âS ========== */
        .history-panel {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            background: var(--gris);
            border-radius: 10px;
            padding: 10px;
        }

        .history-item {
            background: white;
            padding: 8px;
            margin: 5px 0;
            border-radius: 8px;
            border-left: 4px solid var(--vert);
            font-size: 0.8rem;
        }

        .history-time {
            color: var(--gris-fonce);
            font-size: 0.7rem;
        }

        .history-numbers {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
            margin: 3px 0;
        }

        .history-ball {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--vert);
            color: var(--jaune);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- PAGE DE CONNEXION -->
    <div class="login-container" id="loginContainer">
        <div class="login-header">
            <h1>üáπüá¨ <span>LONATO</span> üáπüá¨</h1>
            <p>Connexion avec code personnel ¬∑ 24h d'acc√®s</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('login')" id="tabLogin">üîê CONNEXION</div>
            <div class="tab" onclick="showTab('register')" id="tabRegister">üìù INSCRIPTION</div>
        </div>

        <div id="loginForm">
            <div class="form-group">
                <label>üì± Num√©ro de t√©l√©phone</label>
                <input type="tel" id="phoneInput" placeholder="+228 XX XX XX XX">
            </div>
            <div class="form-group">
                <label>üîë Code personnel √† 6 chiffres</label>
                <input type="text" id="codeInput" class="code-input" maxlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn-login" onclick="verifyCode()">üîì SE CONNECTER</button>
            <div id="loginMessage" class="message-area"></div>
            <div class="info-text">
                <strong>‚ÑπÔ∏è Informations :</strong><br>
                ‚Ä¢ Utilisez votre code personnel enregistr√©<br>
                ‚Ä¢ Acc√®s valable 24h apr√®s la premi√®re connexion<br>
                ‚Ä¢ D√©connexion automatique apr√®s expiration
            </div>
        </div>

        <div id="registerForm" style="display: none;">
            <div class="form-group">
                <label>üë§ Nom complet</label>
                <input type="text" id="regName" placeholder="Votre nom">
            </div>
            <div class="form-group">
                <label>üì± Num√©ro de t√©l√©phone</label>
                <input type="tel" id="regPhone" placeholder="+228 XX XX XX XX">
            </div>
            <div class="form-group">
                <label>üìß Email</label>
                <input type="email" id="regEmail" placeholder="email@exemple.com">
            </div>
            <button class="btn-register" onclick="registerAccount()">üìù CR√âER MON COMPTE</button>
            <div id="registerMessage" class="message-area"></div>
            <div class="info-text">
                <strong>‚ÑπÔ∏è Apr√®s inscription :</strong><br>
                ‚Ä¢ Un code personnel √† 6 chiffres vous sera attribu√©<br>
                ‚Ä¢ Notez ce code pour vos connexions futures<br>
                ‚Ä¢ Le code n'est valable qu'une seule fois pour d√©marrer une session de 24h
            </div>
        </div>
    </div>

    <!-- APPLICATION PRINCIPALE -->
    <div class="app-container" id="appContainer">
        <div class="header">
            <div class="user-info" id="userInfo">üë§ Chargement...</div>
            <div class="timer-display" id="timerDisplay">
                <span>‚è≥</span>
                <span id="timeRemaining">24:00:00</span>
            </div>
            <div class="logout-btn" onclick="logout()">üîí SE D√âCONNECTER</div>
            <h1>üáπüá¨ LONATO ¬∑ SIMULATEUR OFFICIEL üáπüá¨</h1>
            <div class="subtitle">120 permutations ¬∑ Inverse ¬∑ +1 ¬∑ Combin√©</div>
        </div>

        <div class="time-banner">
            <div class="current-time"><span>üïê</span> <span id="currentTimeDisplay">--:--:--</span></div>
            <div class="next-draw">
                <div class="next-draw-info"><span>üé∞ Prochain tirage</span> <span id="nextDrawTime">14:00</span></div>
                <div class="countdown" id="countdownDisplay">--h --min</div>
            </div>
        </div>

        <div class="info-banner" id="accessBanner">
            <strong>üîê ACC√àS VALIDE</strong> ¬∑ Bienvenue sur la plateforme LONATO
        </div>

        <div class="main-content">
            <!-- Colonne principale -->
            <div>
                <div class="panel">
                    <h2>üéØ 1. S√âLECTIONNEZ VOTRE JEU</h2>
                    <div class="days-tabs" id="daysTabs"></div>
                    <div class="games-grid" id="gamesGrid"></div>

                    <h2 style="margin-top:15px;">üé≤ 2. TYPE DE PARI</h2>
                    <div class="bet-types-panel">
                        <div class="bet-type-card selected" onclick="selectBetType('nap')" id="bet-nap">NAP</div>
                        <div class="bet-type-card" onclick="selectBetType('permutation')" id="bet-permutation">PERM</div>
                        <div class="bet-type-card" onclick="selectBetType('banker')" id="bet-banker">BANKERS</div>
                        <div class="bet-type-card" onclick="selectBetType('turbo')" id="bet-turbo">TURBO</div>
                    </div>

                    <div id="turboOptions" style="display:none; margin:10px 0;">
                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                            <div class="turbo-btn selected" onclick="selectTurbo(2, event)" style="flex:1; padding:8px; border:2px solid var(--turbo); border-radius:8px; cursor:pointer; text-align:center;">Turbo 2 √ó10</div>
                            <div class="turbo-btn" onclick="selectTurbo(3, event)" style="flex:1; padding:8px; border:2px solid var(--turbo); border-radius:8px; cursor:pointer; text-align:center;">Turbo 3 √ó5</div>
                            <div class="turbo-btn" onclick="selectTurbo(4, event)" style="flex:1; padding:8px; border:2px solid var(--turbo); border-radius:8px; cursor:pointer; text-align:center;">Turbo 4 √ó3</div>
                        </div>
                    </div>

                    <h2 style="margin-top:15px;">üî¢ 3. S√âLECTIONNEZ 5 NUM√âROS</h2>
                    <div class="numbers-grid" id="numbersGrid"></div>

                    <div class="selected-numbers">
                        <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
                            <span><strong><span id="selectedCount">0</span>/5 num√©ros</strong></span>
                            <button onclick="clearSelection()" style="background:var(--rouge); color:white; border:none; padding:5px 15px; border-radius:20px;">Effacer</button>
                        </div>
                        <div class="selected-tags" id="selectedTags"></div>
                    </div>

                    <div class="stake-info" id="stakeInfo">
                        <span>üí∞ Mise unitaire: <span id="unitStake">100</span> FCFA</span>
                        <span>üìä Mise totale: <span id="totalStake">0</span> FCFA</span>
                    </div>

                    <div class="button-group">
                        <button class="btn-generate" onclick="genererToutesCombinaisons()">üé≤ G√âN√âRER</button>
                        <button class="btn-predict" onclick="lancerAnalysePredictive()" id="btnAnalyse">üîÆ ANALYSE</button>
                        <button class="btn-primary" onclick="copyAllResults()">üìã COPIER TOUT</button>
                        <button class="btn-primary" onclick="afficherHistorique()" style="background:var(--info);">üìú HISTORIQUE</button>
                    </div>

                    <div class="progress-bar"><div class="progress-fill" id="progressBar">0%</div></div>
                </div>

                <div class="panel">
                    <h2>üìä R√âSULTATS</h2>
                    <div style="display:flex; gap:5px; margin-bottom:15px; flex-wrap:wrap;">
                        <button onclick="afficherTous()" style="background:var(--jaune); padding:5px 10px; border:none; border-radius:20px;">Tous</button>
                        <button onclick="afficherPredictions()" style="background:var(--prediction); color:white; padding:5px 10px; border:none; border-radius:20px;">Pr√©dictions</button>
                        <button onclick="afficherParType('nap')" style="background:var(--nap); color:white; padding:5px 10px; border:none; border-radius:20px;">NAP</button>
                        <button onclick="afficherParType('permutation')" style="background:var(--perm); color:white; padding:5px 10px; border:none; border-radius:20px;">PERM</button>
                    </div>
                    <div class="results-container" id="resultsContainer">
                        <div style="text-align:center; padding:30px;">S√©lectionnez un jeu et 5 num√©ros</div>
                    </div>
                    <div class="pagination">
                        <button class="page-btn" onclick="changePage('first')">‚èÆÔ∏è</button>
                        <button class="page-btn" onclick="changePage('prev')">‚óÄ</button>
                        <span class="page-info" id="pageInfo">Page 1/1</span>
                        <button class="page-btn" onclick="changePage('next')">‚ñ∂</button>
                        <button class="page-btn" onclick="changePage('last')">‚è≠Ô∏è</button>
                    </div>
                    <div style="text-align:center; margin-top:10px;" id="totalInfo"></div>
                </div>
            </div>

            <!-- Colonne droite -->
            <div>
                <div class="panel">
                    <h2>üìà TOP PR√âDICTIONS</h2>
                    <div id="topWinners"></div>
                    <button onclick="rafraichirAnalyse()" class="btn-primary" style="width:100%; margin-top:10px;">üîÑ Actualiser</button>
                </div>
                
                <div class="panel">
                    <h2>üìú HISTORIQUE DES ACTIVIT√âS</h2>
                    <div class="history-panel" id="historyContainer">
                        <div style="text-align:center;">Aucune activit√©</div>
                    </div>
                    <button onclick="effacerHistorique()" class="btn-primary" style="width:100%; margin-top:10px; background:var(--rouge);">üóëÔ∏è Effacer l'historique</button>
                </div>
                
                <div class="panel">
                    <h2>‚ÑπÔ∏è INFORMATIONS COMPTE</h2>
                    <div id="accountInfo" style="font-size:0.8rem;">
                        <p><strong>Nom:</strong> <span id="infoName">-</span></p>
                        <p><strong>T√©l√©phone:</strong> <span id="infoPhone">-</span></p>
                        <p><strong>Email:</strong> <span id="infoEmail">-</span></p>
                        <p><strong>Session expire:</strong> <span id="infoExpire">-</span></p>
                        <p><strong>Code utilis√©:</strong> <span id="infoCodeUsed">Non</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>¬© LONATO ¬∑ Acc√®s par code personnel ¬∑ Session de 24h ¬∑ D√©connexion automatique apr√®s expiration</p>
        </div>
    </div>

    <div id="toast" style="display:none;"></div>

    <script>
        // ==================== BASE DE DONN√âES DES COMPTES ====================
        let accounts = [];

        function loadAccounts() {
            const saved = localStorage.getItem('lonato_accounts_database');
            if (saved) {
                try { 
                    accounts = JSON.parse(saved); 
                    console.log('Comptes charg√©s:', accounts.length);
                } 
                catch { 
                    accounts = [];
                    console.log('Erreur chargement comptes');
                }
            } else {
                // Comptes par d√©faut pour d√©monstration
                accounts = [
                    {
                        id: '1',
                        name: 'KOLA JEAN',
                        phone: '+228 92136007',
                        email: 'jeanskodoc22@gmail.com',
                        code: '414954',
                        createdAt: new Date().toISOString(),
                        lastLogin: null,
                        sessions: [], // Historique des sessions
                        used: false, // Le code n'a pas encore √©t√© utilis√© pour d√©marrer une session
                        active: true,
                        history: []
                    },
                    {
                        id: '2',
                        name: 'KODJO MARTIN',
                        phone: '+228 90123456',
                        email: 'martin.kodjo@email.com',
                        code: '123456',
                        createdAt: new Date().toISOString(),
                        lastLogin: null,
                        sessions: [],
                        used: false,
                        active: true,
                        history: []
                    },
                    {
                        id: '3',
                        name: 'AMOUSSOU MARIE',
                        phone: '+228 98765432',
                        email: 'marie.a@email.com',
                        code: '789012',
                        createdAt: new Date().toISOString(),
                        lastLogin: null,
                        sessions: [],
                        used: false,
                        active: true,
                        history: []
                    }
                ];
                saveAccounts();
                console.log('Comptes par d√©faut cr√©√©s');
            }
        }

        function saveAccounts() {
            localStorage.setItem('lonato_accounts_database', JSON.stringify(accounts));
            console.log('Comptes sauvegard√©s');
        }

        // Nettoyer les comptes inactifs (optionnel)
        function cleanupAccounts() {
            // Ne pas supprimer les comptes, juste les marquer si n√©cessaire
            // Cette fonction peut √™tre utilis√©e pour d√©sactiver des comptes anciens
        }

        // ==================== GESTION DE L'HISTORIQUE ====================
        function ajouterHistorique(action, details, numbers) {
            if (!state.currentUser) return;
            
            const account = accounts.find(a => a.phone === state.currentUser.phone);
            if (!account) return;
            
            if (!account.history) account.history = [];
            
            account.history.push({
                timestamp: new Date().toISOString(),
                action: action,
                details: details,
                numbers: numbers || [],
                game: state.currentGame,
                betType: state.betType
            });
            
            // Limiter l'historique aux 50 derni√®res entr√©es
            if (account.history.length > 50) {
                account.history = account.history.slice(-50);
            }
            
            saveAccounts();
            afficherHistorique();
        }

        function afficherHistorique() {
            if (!state.currentUser) return;
            
            const account = accounts.find(a => a.phone === state.currentUser.phone);
            if (!account || !account.history || account.history.length === 0) {
                document.getElementById('historyContainer').innerHTML = '<div style="text-align:center;">Aucune activit√©</div>';
                return;
            }
            
            const history = [...account.history].reverse(); // Plus r√©cent en premier
            let html = '';
            
            history.forEach((item, index) => {
                const date = new Date(item.timestamp);
                const timeStr = date.toLocaleTimeString('fr-FR');
                const dateStr = date.toLocaleDateString('fr-FR');
                
                let numbersHtml = '';
                if (item.numbers && item.numbers.length > 0) {
                    numbersHtml = '<div class="history-numbers">' + 
                        item.numbers.map(n => `<span class="history-ball">${n < 10 ? '0' + n : n}</span>`).join('') + 
                        '</div>';
                }
                
                html += `
                    <div class="history-item">
                        <div class="history-time">${dateStr} ${timeStr}</div>
                        <div><strong>${item.action}</strong> ${item.details || ''}</div>
                        ${numbersHtml}
                        <div style="font-size:0.7rem; color:#666;">${item.game || ''} ${item.betType ? '- ' + item.betType.toUpperCase() : ''}</div>
                    </div>
                `;
            });
            
            document.getElementById('historyContainer').innerHTML = html;
        }

        function effacerHistorique() {
            if (!state.currentUser) return;
            
            if (confirm('Voulez-vous vraiment effacer tout l\'historique ?')) {
                const account = accounts.find(a => a.phone === state.currentUser.phone);
                if (account) {
                    account.history = [];
                    saveAccounts();
                    afficherHistorique();
                    showToast('Historique effac√©', 'success');
                }
            }
        }

        function updateAccountInfo() {
            if (!state.currentUser) return;
            
            const account = accounts.find(a => a.phone === state.currentUser.phone);
            if (!account) return;
            
            document.getElementById('infoName').textContent = account.name;
            document.getElementById('infoPhone').textContent = account.phone;
            document.getElementById('infoEmail').textContent = account.email;
            document.getElementById('infoCodeUsed').textContent = account.used ? 'Oui' : 'Non';
            
            if (state.currentUser.sessionExpiry) {
                const expiry = new Date(state.currentUser.sessionExpiry);
                document.getElementById('infoExpire').textContent = expiry.toLocaleString('fr-FR');
            } else {
                document.getElementById('infoExpire').textContent = '-';
            }
        }

        // ==================== VARIABLES DE TEMPS ====================
        let sessionExpiry = null;
        let timerInterval = null;

        // ==================== ONGLETS ====================
        function showTab(tab) {
            document.getElementById('loginForm').style.display = tab === 'login' ? 'block' : 'none';
            document.getElementById('registerForm').style.display = tab === 'register' ? 'block' : 'none';
            document.getElementById('tabLogin').classList.toggle('active', tab === 'login');
            document.getElementById('tabRegister').classList.toggle('active', tab === 'register');
        }

        // ==================== INSCRIPTION ====================
        function registerAccount() {
            const name = document.getElementById('regName').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            
            if (!name || !phone || !email) {
                showMessage('register', 'Veuillez remplir tous les champs', 'error');
                return;
            }
            
            // V√©rifier si le t√©l√©phone existe d√©j√†
            if (accounts.some(a => a.phone === phone)) {
                showMessage('register', 'Ce num√©ro existe d√©j√†', 'error');
                return;
            }
            
            // G√©n√©rer un code unique √† 6 chiffres
            let code;
            do {
                code = Math.floor(100000 + Math.random() * 900000).toString();
            } while (accounts.some(a => a.code === code)); // √âviter les doublons de code
            
            const newAccount = {
                id: Date.now().toString(),
                name: name,
                phone: phone,
                email: email,
                code: code,
                createdAt: new Date().toISOString(),
                lastLogin: null,
                sessions: [],
                used: false, // Code pas encore utilis√© pour une session
                active: true,
                history: []
            };
            
            accounts.push(newAccount);
            saveAccounts();
            
            showMessage('register', `‚úÖ Compte cr√©√© ! Votre code personnel : ${code}`, 'success');
            
            // Pr√©-remplir le formulaire de connexion
            document.getElementById('phoneInput').value = phone;
            document.getElementById('codeInput').value = code;
            
            setTimeout(() => showTab('login'), 3000);
        }

        // ==================== AUTHENTIFICATION ====================
        function verifyCode() {
            const phone = document.getElementById('phoneInput').value.trim();
            const code = document.getElementById('codeInput').value.trim();
            
            if (!phone || !code) {
                showMessage('login', 'Veuillez remplir tous les champs', 'error');
                return;
            }

            // Chercher le compte correspondant
            const account = accounts.find(a => a.phone === phone && a.code === code);

            if (!account) {
                showMessage('login', '‚ùå Num√©ro ou code incorrect', 'error');
                return;
            }

            // V√©rifier si le compte est actif
            if (!account.active) {
                showMessage('login', '‚ùå Ce compte a √©t√© d√©sactiv√©', 'error');
                return;
            }

            // GESTION DE L'USAGE UNIQUE DU CODE
            // Si le code a d√©j√† √©t√© utilis√© pour d√©marrer une session
            if (account.used) {
                // V√©rifier si la derni√®re session est encore valide
                const lastSession = account.sessions && account.sessions.length > 0 ? 
                    account.sessions[account.sessions.length - 1] : null;
                
                if (lastSession) {
                    const now = new Date();
                    const sessionExpiryTime = new Date(lastSession.expiresAt);
                    
                    if (now < sessionExpiryTime) {
                        // Session encore valide - connexion automatique
                        console.log('Session existante encore valide');
                        
                        // Restaurer la session
                        sessionExpiry = sessionExpiryTime;
                        startSessionTimer();
                        
                        state.currentUser = {
                            phone: account.phone,
                            name: account.name,
                            email: account.email,
                            sessionExpiry: lastSession.expiresAt,
                            sessionStarted: lastSession.startedAt
                        };
                        
                        localStorage.setItem('lonato_auth', JSON.stringify({
                            phone: account.phone,
                            name: account.name,
                            sessionExpiry: lastSession.expiresAt
                        }));
                        
                        document.body.classList.add('authenticated');
                        document.getElementById('userInfo').innerHTML = `üë§ ${account.name}`;
                        document.getElementById('accessBanner').innerHTML = `
                            <strong>üîê SESSION REPRISE</strong><br>
                            üë§ ${account.name}<br>
                            üì± ${account.phone}<br>
                            ‚è∞ Session expire dans <span id="sessionTimer">24:00:00</span>
                        `;
                        
                        // Mettre √† jour les infos
                        updateAccountInfo();
                        afficherHistorique();
                        
                        showToast(`Bienvenue ${account.name} - Session reprise`, 'success');
                        ajouterHistorique('RECONNEXION', 'Session existante reprise');
                        
                        return;
                    } else {
                        // Session expir√©e - demander un nouveau code
                        showMessage('login', '‚è∞ Votre session a expir√©. Vous devez utiliser un nouveau code.', 'error');
                        return;
                    }
                } else {
                    showMessage('login', '‚ùå Ce code a d√©j√† √©t√© utilis√©. Contactez l\'administrateur.', 'error');
                    return;
                }
            }

            // PREMI√àRE UTILISATION DU CODE
            // D√©finir la date d'expiration de la session (24h √† partir de maintenant)
            const now = new Date();
            const expiryDate = new Date(now.getTime() + 24 * 60 * 60 * 1000);
            
            // Cr√©er une nouvelle session
            const session = {
                startedAt: now.toISOString(),
                expiresAt: expiryDate.toISOString(),
                ip: 'client', // Optionnel
                userAgent: navigator.userAgent
            };
            
            if (!account.sessions) account.sessions = [];
            account.sessions.push(session);
            
            // Marquer le code comme utilis√©
            account.used = true;
            account.lastLogin = now.toISOString();
            
            saveAccounts();

            // D√©marrer la session
            sessionExpiry = expiryDate;
            startSessionTimer();

            state.currentUser = {
                phone: account.phone,
                name: account.name,
                email: account.email,
                sessionExpiry: expiryDate.toISOString(),
                sessionStarted: now.toISOString()
            };
            
            localStorage.setItem('lonato_auth', JSON.stringify({
                phone: account.phone,
                name: account.name,
                sessionExpiry: expiryDate.toISOString()
            }));
            
            document.body.classList.add('authenticated');
            document.getElementById('userInfo').innerHTML = `üë§ ${account.name}`;
            document.getElementById('accessBanner').innerHTML = `
                <strong>üîê PREMI√àRE CONNEXION</strong><br>
                üë§ ${account.name}<br>
                üì± ${account.phone}<br>
                ‚è∞ Session expire dans <span id="sessionTimer">24:00:00</span><br>
                <small>Code utilis√©: ${code}</small>
            `;
            
            // Mettre √† jour les infos
            updateAccountInfo();
            afficherHistorique();
            
            showToast(`Bienvenue ${account.name} - Session de 24h d√©marr√©e`, 'success');
            ajouterHistorique('PREMI√àRE CONNEXION', 'Session de 24h d√©marr√©e');
        }

        // ==================== GESTION DU TEMPS RESTANT ====================
        function startSessionTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                if (!sessionExpiry) return;
                
                const now = new Date();
                const timeLeft = sessionExpiry - now;
                
                if (timeLeft <= 0) {
                    // Session expir√©e
                    clearInterval(timerInterval);
                    showToast('‚è∞ Session expir√©e - D√©connexion automatique', 'info');
                    
                    // Marquer la session comme expir√©e dans le compte
                    if (state.currentUser) {
                        const account = accounts.find(a => a.phone === state.currentUser.phone);
                        if (account && account.sessions && account.sessions.length > 0) {
                            const lastSession = account.sessions[account.sessions.length - 1];
                            if (lastSession) {
                                lastSession.expired = true;
                                saveAccounts();
                            }
                        }
                    }
                    
                    setTimeout(() => {
                        logout();
                    }, 2000);
                    return;
                }
                
                // Calculer heures:minutes:secondes restantes
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                const timeString = `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
                
                // Mettre √† jour l'affichage
                document.getElementById('timeRemaining').textContent = timeString;
                const timerSpan = document.getElementById('sessionTimer');
                if (timerSpan) timerSpan.textContent = timeString;
                
                // Alerte quand il reste moins de 5 minutes
                const timerDisplay = document.getElementById('timerDisplay');
                if (timeLeft < 5 * 60 * 1000) {
                    timerDisplay.classList.add('warning');
                } else {
                    timerDisplay.classList.remove('warning');
                }
            }, 1000);
        }

        function checkExistingAuth() {
            const saved = localStorage.getItem('lonato_auth');
            if (!saved) return false;
            
            try {
                const auth = JSON.parse(saved);
                const now = new Date();
                const expiry = new Date(auth.sessionExpiry);
                
                if (now > expiry) {
                    localStorage.removeItem('lonato_auth');
                    return false;
                }
                
                // V√©rifier que le compte existe toujours
                const account = accounts.find(a => a.phone === auth.phone);
                if (!account) {
                    localStorage.removeItem('lonato_auth');
                    return false;
                }
                
                sessionExpiry = expiry;
                startSessionTimer();
                
                state.currentUser = {
                    phone: account.phone,
                    name: account.name,
                    email: account.email,
                    sessionExpiry: auth.sessionExpiry
                };
                
                document.body.classList.add('authenticated');
                document.getElementById('userInfo').innerHTML = `üë§ ${account.name}`;
                document.getElementById('accessBanner').innerHTML = `
                    <strong>üîê SESSION ACTIVE</strong><br>
                    üë§ ${account.name}<br>
                    üì± ${account.phone}<br>
                    ‚è∞ Expire dans <span id="sessionTimer">24:00:00</span>
                `;
                
                updateAccountInfo();
                afficherHistorique();
                
                return true;
            } catch {
                return false;
            }
        }

        function logout() {
            if (state.currentUser) {
                ajouterHistorique('D√âCONNEXION', 'Session termin√©e');
            }
            
            localStorage.removeItem('lonato_auth');
            document.body.classList.remove('authenticated');
            state.currentUser = null;
            if (timerInterval) clearInterval(timerInterval);
            showToast('D√©connexion r√©ussie', 'success');
        }

        function showMessage(form, text, type) {
            const div = document.getElementById(form + 'Message');
            div.innerHTML = `<div class="${type === 'error' ? 'warning-message' : 'success-message'}">${type === 'error' ? '‚ùå' : '‚úÖ'} ${text}</div>`;
            setTimeout(() => div.innerHTML = '', 5000);
        }

        // ==================== CONFIGURATION DES JEUX ====================
        const gamesConfig = {
            diamant: { name: 'DIAMANT', day: 'lundi', draw: '14h', drawHour: 14, mise: 100 },
            gold: { name: 'GOLD', day: 'lundi', draw: '18h', drawHour: 18, mise: 100 },
            cash: { name: 'CASH', day: 'mardi', draw: '14h', drawHour: 14, mise: 100 },
            boom: { name: 'BOOM', day: 'mardi', draw: '18h', drawHour: 18, mise: 100 },
            benz: { name: 'BENZ', day: 'mercredi', draw: '14h', drawHour: 14, mise: 100 },
            prestige: { name: 'PRESTIGE', day: 'mercredi', draw: '18h', drawHour: 18, mise: 100 },
            millions: { name: 'MILLIONS', day: 'jeudi', draw: '14h', drawHour: 14, mise: 100 },
            super: { name: 'SUPER', day: 'jeudi', draw: '18h', drawHour: 18, mise: 500 },
            kadoo: { name: 'KADOO', day: 'vendredi', draw: '14h', drawHour: 14, mise: 100 },
            king: { name: 'KING', day: 'vendredi', draw: '18h', drawHour: 18, mise: 100 },
            sam: { name: 'SAM', day: 'samedi', draw: '14h', drawHour: 14, mise: 100 },
            bingo: { name: 'BINGO', day: 'samedi', draw: '18h', drawHour: 18, mise: 100 }
        };

        // ==================== √âTAT ====================
        let state = {
            currentDay: 'lundi',
            currentGame: 'diamant',
            betType: 'nap',
            turboLevel: 2,
            selectedNumbers: new Set(),
            bankers: new Set(),
            allCombinations: [],
            filteredCombinations: [],
            predictions: [],
            currentPage: 1,
            itemsPerPage: 15,
            currentUser: null
        };

        // ==================== FONCTIONS D'HEURE ====================
        function updateTimeDisplay() {
            const now = new Date();
            document.getElementById('currentTimeDisplay').textContent = now.toLocaleTimeString('fr-FR');
            const h = now.getHours(), m = now.getMinutes();
            let next = h < 14 ? '14:00' : (h < 18 ? '18:00' : 'demain 14:00');
            document.getElementById('nextDrawTime').textContent = next;
            let target = h < 14 ? 14 : (h < 18 ? 18 : 14);
            let diff = (target + (target < h ? 24 : 0) - h) * 60 - m;
            let hours = Math.floor(diff/60);
            let minutes = diff % 60;
            document.getElementById('countdownDisplay').textContent = `${hours}h ${minutes}min`;
        }

        // ==================== INTERFACE ====================
        function createDaysTabs() {
            const days = ['lundi','mardi','mercredi','jeudi','vendredi','samedi'];
            const container = document.getElementById('daysTabs');
            container.innerHTML = '';
            days.forEach(day => {
                let tab = document.createElement('div');
                tab.className = `day-tab ${state.currentDay === day ? 'active' : ''}`;
                tab.textContent = day.substring(0,3).toUpperCase();
                tab.onclick = () => selectDay(day);
                container.appendChild(tab);
            });
        }

        function selectDay(day) {
            state.currentDay = day;
            createDaysTabs();
            createGamesGrid();
            let first = Object.keys(gamesConfig).find(id => gamesConfig[id].day === day);
            if (first) selectGame(first);
        }

        function createGamesGrid() {
            const grid = document.getElementById('gamesGrid');
            grid.innerHTML = '';
            Object.entries(gamesConfig).filter(([id,g]) => g.day === state.currentDay).forEach(([id,g]) => {
                let card = document.createElement('div');
                card.className = `game-card ${state.currentGame === id ? 'selected' : ''}`;
                card.id = `game-${id}`;
                card.innerHTML = `<div class="game-name">${g.name}</div><div>üé∞ ${g.draw}</div><div>üí∞ ${g.mise} FCFA</div>`;
                card.onclick = () => selectGame(id);
                grid.appendChild(card);
            });
        }

        function selectGame(id) {
            state.currentGame = id;
            document.querySelectorAll('.game-card').forEach(c => c.classList.remove('selected'));
            document.getElementById(`game-${id}`)?.classList.add('selected');
            document.getElementById('unitStake').textContent = gamesConfig[id].mise;
            updateStake();
        }

        function selectBetType(type) {
            state.betType = type;
            document.querySelectorAll('.bet-type-card').forEach(c => c.classList.remove('selected'));
            document.getElementById(`bet-${type}`).classList.add('selected');
            document.getElementById('turboOptions').style.display = type === 'turbo' ? 'block' : 'none';
            clearSelection();
        }

        function selectTurbo(level, event) {
            state.turboLevel = level;
            document.querySelectorAll('.turbo-btn').forEach(b => b.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        function createNumberGrid() {
            const grid = document.getElementById('numbersGrid');
            grid.innerHTML = '';
            for (let i=1; i<=90; i++) {
                let btn = document.createElement('div');
                btn.className = `number-btn ${state.selectedNumbers.has(i) ? 'selected' : ''} ${state.bankers.has(i) ? 'banker' : ''}`;
                btn.textContent = i < 10 ? '0'+i : i;
                btn.onclick = (e) => toggleNumber(i, e);
                grid.appendChild(btn);
            }
        }

        function toggleNumber(n, event) {
            const max = state.betType === 'turbo' ? 2 : 5;
            
            if (state.betType === 'banker' && (event.ctrlKey || event.metaKey)) {
                if (state.bankers.has(n)) {
                    state.bankers.delete(n);
                    state.selectedNumbers.delete(n);
                } else if (state.bankers.size + state.selectedNumbers.size < max) {
                    state.bankers.add(n);
                    state.selectedNumbers.add(n);
                }
            } else {
                if (state.selectedNumbers.has(n)) {
                    state.selectedNumbers.delete(n);
                    state.bankers.delete(n);
                } else if (state.selectedNumbers.size < max) {
                    state.selectedNumbers.add(n);
                } else {
                    showToast('Maximum atteint', 'error');
                    return;
                }
            }
            updateSelection();
            createNumberGrid();
        }

        function removeNumber(n) {
            state.selectedNumbers.delete(n);
            state.bankers.delete(n);
            updateSelection();
            createNumberGrid();
        }

        function clearSelection() {
            state.selectedNumbers.clear();
            state.bankers.clear();
            updateSelection();
            createNumberGrid();
            state.allCombinations = [];
            state.filteredCombinations = [];
            state.predictions = [];
            displayResults();
        }

        function updateSelection() {
            let nums = Array.from(state.selectedNumbers).sort((a,b)=>a-b);
            document.getElementById('selectedTags').innerHTML = nums.map(n => 
                `<span class="number-tag ${state.bankers.has(n)?'banker':''}">${n<10?'0'+n:n}${state.bankers.has(n)?' üëë':''}<button onclick="removeNumber(${n})">√ó</button></span>`
            ).join('');
            document.getElementById('selectedCount').textContent = nums.length;
            updateStake();
        }

        function updateStake() {
            let count = 1;
            if (state.betType === 'permutation' && state.selectedNumbers.size >= 5) {
                count = combinationCount(state.selectedNumbers.size, 5);
            }
            let total = count * (gamesConfig[state.currentGame]?.mise || 100);
            document.getElementById('totalStake').textContent = total;
        }

        // ==================== MATH√âMATIQUES ====================
        function factorial(n) { return n <= 1 ? 1 : n * factorial(n-1); }
        function combinationCount(n,k) { return k > n ? 0 : factorial(n) / (factorial(k) * factorial(n-k)); }
        function combine(arr,k) {
            if (k === 0) return [[]];
            if (arr.length === 0) return [];
            let [first, ...rest] = arr;
            let res = [];
            let withFirst = combine(rest, k-1).map(c => [first, ...c]);
            let withoutFirst = combine(rest, k);
            return [...withFirst, ...withoutFirst];
        }
        function permuter(arr) {
            if (arr.length === 0) return [[]];
            let res = [];
            for (let i=0; i<arr.length; i++) {
                let reste = [...arr.slice(0,i), ...arr.slice(i+1)];
                for (let p of permuter(reste)) res.push([arr[i], ...p]);
            }
            return res;
        }
        function inv(n) { return n < 10 ? n*10 : parseInt(n.toString().split('').reverse().join('')); }
        function plus1(n) { return n === 90 ? 1 : n+1; }

        // ==================== G√âN√âRATION ====================
        function genererToutesCombinaisons() {
            let nums = Array.from(state.selectedNumbers).sort((a,b)=>a-b);
            if (nums.length !== 5 && state.betType !== 'turbo') { showToast('5 num√©ros requis','error'); return; }
            if (state.betType === 'turbo' && nums.length !== 2) { showToast('2 num√©ros requis','error'); return; }
            
            updateProgress(20);
            let base = [];
            if (state.betType === 'nap') base = [nums];
            else if (state.betType === 'permutation') base = nums.length >= 5 ? combine(nums,5) : [];
            else if (state.betType === 'banker') {
                let bankers = Array.from(state.bankers).sort();
                let others = nums.filter(n => !state.bankers.has(n));
                if (!bankers.length) { showToast('D√©finissez des bankers','error'); return; }
                let k = 5 - bankers.length;
                base = combine(others, k).map(c => [...bankers, ...c].sort());
            } else base = [nums];

            let all = [], seen = new Set();
            base.forEach(b => {
                permuter(b).forEach(p => {
                    let key = p.join('|');
                    if (!seen.has(key)) { seen.add(key); all.push({ numbers: [...p], type: 'nap', label: 'Position' }); }
                });
                [inv, plus1, n=>plus1(inv(n)), n=>inv(plus1(n))].forEach((fn,idx) => {
                    let transformed = b.map(fn);
                    let key = transformed.join('|');
                    if (!seen.has(key)) {
                        seen.add(key);
                        all.push({ numbers: transformed, type: 'nap', label: ['Inverse','+1','Inv‚Üí+1','+1‚ÜíInv'][idx] });
                    }
                });
            });
            
            state.allCombinations = all;
            state.filteredCombinations = all;
            state.currentPage = 1;
            displayResults();
            updateProgress(100); setTimeout(()=>updateProgress(0),300);
            
            // Ajouter √† l'historique
            ajouterHistorique('G√âN√âRATION', `${all.length} combinaisons`, nums);
            
            showToast(`${all.length} combinaisons`, 'success');
        }

        // ==================== AFFICHAGE ====================
        function displayResults() {
            let data = state.filteredCombinations;
            let container = document.getElementById('resultsContainer');
            if (!data.length) { container.innerHTML = '<div style="text-align:center; padding:30px;">Aucun r√©sultat</div>'; return; }
            
            let start = (state.currentPage-1)*state.itemsPerPage;
            let page = data.slice(start, start+state.itemsPerPage);
            
            container.innerHTML = page.map((item,i) => {
                let idx = start + i + 1;
                let balls = item.numbers.map((n,j) => 
                    `<span class="ball" data-color="${(j%7)+1}">${n<10?'0'+n:n}</span>`
                ).join('');
                
                // √âchapper correctement les apostrophes dans le texte pour √©viter les erreurs JavaScript
                let serieText = item.numbers.map(n => n < 10 ? '0' + n : n).join(' - ') + ' (' + item.label + ')';
                let escapedText = serieText.replace(/'/g, "\\'");
                
                return `<div class="result-item nap">
                    <div class="result-header">
                        <span style="font-weight:bold; min-width:35px;">#${idx}</span>
                        <span>${balls}</span>
                        <span class="type-badge">${item.label}</span>
                    </div>
                    <div style="display:flex; justify-content:flex-end;">
                        <button class="btn-copy" onclick="copySerie('${escapedText}', this)">üìã Copier</button>
                    </div>
                </div>`;
            }).join('');
            
            document.getElementById('totalInfo').textContent = `${data.length} combinaison(s)`;
            updatePagination(data.length);
        }

        function afficherTous() { state.filteredCombinations = state.allCombinations; state.currentPage=1; displayResults(); }
        function afficherParType(type) { state.filteredCombinations = state.allCombinations; state.currentPage=1; displayResults(); }
        function afficherPredictions() { state.filteredCombinations = state.predictions; state.currentPage=1; displayResults(); }

        function lancerAnalysePredictive() {
            if (!state.allCombinations.length) { showToast('G√©n√©rez d\'abord','error'); return; }
            let scored = state.allCombinations.map(c => ({ ...c, score: 1 + Math.random() * 2, prob: 50 + Math.random() * 30 }));
            scored.sort((a,b)=>b.score - a.score);
            state.predictions = scored.slice(0,10);
            afficherPredictions();
            afficherTopWinners();
            
            // Ajouter √† l'historique
            ajouterHistorique('ANALYSE', 'Pr√©dictions g√©n√©r√©es');
        }

        function afficherTopWinners() {
            let container = document.getElementById('topWinners');
            if (!state.predictions.length) { container.innerHTML = '<div style="text-align:center;">Aucune pr√©diction</div>'; return; }
            container.innerHTML = '<h4 style="margin-bottom:8px;">üîÆ Top 10</h4>';
            state.predictions.slice(0,10).forEach((p,i) => {
                let balls = p.numbers.map((n,j) => `<span style="display:inline-block; width:24px; height:24px; border-radius:50%; background:var(--arc-bleu); color:white; text-align:center; line-height:24px; font-size:0.6rem; margin:0 1px;">${n<10?'0'+n:n}</span>`).join('');
                
                // √âchapper correctement les apostrophes
                let serieText = p.numbers.map(n => n < 10 ? '0' + n : n).join(' - ') + ' (' + p.label + ')';
                let escapedText = serieText.replace(/'/g, "\\'");
                
                container.innerHTML += `
                    <div style="background:rgba(255,255,255,0.05); margin:8px 0; padding:8px; border-radius:8px;">
                        <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-bottom:5px;">
                            <span style="font-weight:bold; color:var(--jackpot);">#${i+1}</span>
                            <span>${balls}</span>
                            <span class="type-badge">${p.label}</span>
                            <span style="background:var(--jackpot); color:white; padding:2px 6px; border-radius:10px; font-size:0.6rem;">${p.prob.toFixed(1)}%</span>
                        </div>
                        <button class="btn-copy" style="width:100%;" onclick="copySerie('${escapedText}', this)">üìã Copier</button>
                    </div>`;
            });
        }

        // ==================== FONCTIONS DE COPIE CORRIG√âES ====================
        function copySerie(text, btn) {
            // Utiliser l'API Clipboard moderne avec fallback
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    // Succ√®s
                    btn.innerText = '‚úÖ Copi√©!'; 
                    btn.classList.add('copied');
                    setTimeout(() => { 
                        btn.innerText = 'üìã Copier'; 
                        btn.classList.remove('copied'); 
                    }, 1500);
                    showToast('Copi√© !', 'success');
                    
                    // Ajouter √† l'historique
                    ajouterHistorique('COPIE', text.substring(0, 30) + '...');
                }).catch(err => {
                    // Fallback en cas d'erreur
                    fallbackCopy(text, btn);
                });
            } else {
                // Fallback pour les navigateurs plus anciens
                fallbackCopy(text, btn);
            }
        }

        function fallbackCopy(text, btn) {
            // M√©thode de secours utilisant un √©l√©ment textarea temporaire
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            textarea.setSelectionRange(0, 99999); // Pour mobile
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    btn.innerText = '‚úÖ Copi√©!'; 
                    btn.classList.add('copied');
                    setTimeout(() => { 
                        btn.innerText = 'üìã Copier'; 
                        btn.classList.remove('copied'); 
                    }, 1500);
                    showToast('Copi√© !', 'success');
                    ajouterHistorique('COPIE', text.substring(0, 30) + '...');
                } else {
                    showToast('Erreur de copie', 'error');
                }
            } catch (err) {
                showToast('Copie non support√©e', 'error');
            }
            
            document.body.removeChild(textarea);
        }

        function copyAllResults() {
            let data = state.filteredCombinations;
            if (!data.length) {
                showToast('Aucun r√©sultat √† copier', 'error');
                return;
            }
            
            let text = `${gamesConfig[state.currentGame].name} - ${data.length} combinaisons\n\n`;
            data.forEach((c,i) => { 
                text += `${i+1}. ${c.numbers.map(n=>n<10?'0'+n:n).join(' - ')} (${c.label})\n`; 
            });
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast(`${data.length} combinaisons copi√©es`, 'success');
                    ajouterHistorique('COPIE TOUT', `${data.length} combinaisons`);
                }).catch(() => {
                    fallbackCopyAll(text);
                });
            } else {
                fallbackCopyAll(text);
            }
        }

        function fallbackCopyAll(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast('Copi√© !', 'success');
                } else {
                    showToast('Erreur de copie', 'error');
                }
            } catch (err) {
                showToast('Copie non support√©e', 'error');
            }
            
            document.body.removeChild(textarea);
        }

        // ==================== PAGINATION ====================
        function updatePagination(total) {
            let pages = Math.ceil(total / state.itemsPerPage) || 1;
            document.getElementById('pageInfo').textContent = `Page ${state.currentPage}/${pages}`;
        }
        function changePage(cmd) {
            let pages = Math.ceil(state.filteredCombinations.length / state.itemsPerPage) || 1;
            if (cmd === 'next' && state.currentPage < pages) state.currentPage++;
            else if (cmd === 'prev' && state.currentPage > 1) state.currentPage--;
            else if (cmd === 'first') state.currentPage = 1;
            else if (cmd === 'last') state.currentPage = pages;
            displayResults();
        }

        // ==================== TOAST ====================
        function showToast(msg, type='success') {
            let t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'toast-message';
            t.style.backgroundColor = type==='success' ? 'var(--vert)' : (type==='error' ? 'var(--rouge)' : 'var(--info)');
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        function updateProgress(p) {
            let bar = document.getElementById('progressBar');
            bar.style.width = p + '%';
            bar.textContent = p + '%';
        }

        function rafraichirAnalyse() { if (state.allCombinations.length) lancerAnalysePredictive(); }

        // ==================== INIT ====================
        function init() {
            loadAccounts();
            cleanupAccounts();
            
            if (!checkExistingAuth()) {
                document.body.classList.remove('authenticated');
            }
            
            createDaysTabs();
            createGamesGrid();
            createNumberGrid();
            selectGame('diamant');
            updateTimeDisplay();
            setInterval(updateTimeDisplay, 1000);
        }
        init();
    </script>
</body>
</html>
